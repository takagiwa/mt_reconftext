
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Text of reconfigurable device 0.0.1 ドキュメント</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>知能ディジタル回路・設計<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<span id="document-01_introduction"></span><div class="section" id="id1">
<h2><span class="section-number">1. </span>はじめに<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>本書の目的は VHDL による FPGA (CPLD) への論理回路の実装を一通り体験することです。</p>
<p>到達目標に、「VHDL によるストップウォッチの実装」を設定し、VHDL の説明と実習を行います。</p>
<p>八戸高専の場合、「ディジタル回路」「ディジタル回路」「ディジタル信号処理」と重複するところがあります。それらの授業で学んだことが実習の助けになるでしょう。</p>
<div class="section" id="id2">
<h3><span class="section-number">1.1. </span>受講にあたって<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下の点に注意、協力してください。</p>
<ul class="simple">
<li><p>お昼休みには基板の電源を切ってください。変な回路を書き込んでおいてデバイスに負荷をかけて壊してしまうことを避けるためです。</p></li>
<li><p>演習 = このテキスト通りに入力して動作を確認するもの、課題 = 自力でコードを書いて動作させるもの、としています。</p></li>
<li><p>演習、課題でどうしてもツールのエラーが消せないときは呼んでください。</p></li>
<li><p>課題はできあがったら基板を持って見せに来てください。達成度を記録します。</p></li>
<li><p>成績は、課題の達成度と筆記試験から求めます。</p></li>
<li><p>筆記試験は最終日に行い、テキストなどの持ち込みは不可です。</p></li>
<li><p>欠席せざるを得ないことがあると思います。そのとき課題は授業中、どうにもならないときは後からおこなってください。</p></li>
</ul>
</div>
</div>
<span id="document-02_stopwatch"></span><div class="section" id="id1">
<h2><span class="section-number">2. </span>ストップウォッチについて<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ディジタルタイプのストップウォッチの例を図に示します。通常「スタート・ストップ」「ラップ・リセット」の２つのボタンと、６桁程度の数字のディスプレイがあります。</p>
<p>「スタート・ストップ」のボタンは、押す毎に「計時」の実行、停止が切り替わります。リセットしない限り、計時は停止した値から再開されます。</p>
<p>「ラップ・リセット」は、停止時に押すと値がクリアされます。計時を行っているときに押すと、通常計時中は変化し続けている数字が停止しますが、計時は続けられています。</p>
<p>実際にはここでは２つの動作があり、「スプリット」では値は引き続きカウントアップしていますが、「ラップ」ではラップボタンで計時は０から再開されます。</p>
<p>数字のディスプレイは通常上位から２桁ずつ、分、秒、1/100 秒のカウントを表示します。</p>
<div class="section" id="id2">
<h3><span class="section-number">2.1. </span>実装目標<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>最低限の目標は以下の機能を VHDL で実装することです。</p>
<dl class="simple">
<dt>４桁の数字の表示</dt><dd><p>上位２桁は秒、下位２桁は1/100 秒です。</p>
</dd>
<dt>「スタート・ストップ」スイッチの動作</dt><dd><p>一つのスイッチで行います。</p>
</dd>
<dt>「ラップ・リセット」スイッチはリセット動作の実装</dt><dd><p>停止中に値のリセットが行えること。</p>
</dd>
</dl>
<p>追加目標はラップ機能、スプリット機能の実装となります。</p>
</div>
</div>
<span id="document-03_fpga"></span><div class="section" id="fpga">
<h2><span class="section-number">3. </span>FPGA について<a class="headerlink" href="#fpga" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>FPGA はディジタル信号を取り扱う IC、LSI の一種です。</p>
<p>ターゲットの回路が決まっており、予算が十分にあれば、専用の IC 、LSI を製造するのが、デバイス単価、動作周波数、消費電力のいずれも有利です。</p>
<p>それに対し FPGA は内部に組み込む回路を書き換えられることが利点となっています。</p>
<p>「試作・実験」「少量多品種」に向いたデバイスです。</p>
<p>使用例:</p>
<dl class="simple">
<dt>液晶テレビ</dt><dd><p>FPGA の単価は一般に同じ規模の LSI より高いため、家電製品に FPGA が使われることはありませんが、ある液晶テレビでは一時 FPGA が使われました。
理由は明らかではありませんが、恐らく LSI の設計、製造が間に合わないか、組み込む回路に変更が入る恐れがあったものと考えられます。
LSI は設計や製造に時間がかかり、また内部の回路変更には作り直しが必要ですが、FPGA では直ぐに回路を組み込むことができ、データを入れ替えるだけで変更も可能です。</p>
</dd>
<dt>携帯電話と基地局の試作機</dt><dd><p>携帯電話や基地局は世界的な規格に則って作られますが、規格が固まってから作っていると発売が遅くなってしまいます。
規格が固まる前にシステムを作ってしまい、規格変更に合わせてあとから回路が変更できるよう、FPGA が大量に使われます。
規格や回路が固まったら、必要に応じて LSI に移行します。</p>
</dd>
<dt>株・為替自動取引</dt><dd><p>コンピュータによる高頻度取引では１秒以下の周期で株価、為替の情報を監視し、自身に有利なタイミングで売買を行います。
ソフトウェアだけでの処理は遅いと考えられており、FPGA による処理が併用されます。
処理のアルゴリズムは使用者毎に異なるため、LSI 化はできず、FPGA が使用されます。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>実際にこの授業で使用するデバイスは「PLD」と呼ばれます。PLD は Programmable Logic Device の略です。プログラム可能な論理デバイス、となります。</p>
<p>対して FPGA は Field Programmable Gate Array の略です。現場 (Field) でプログラム可能なゲート (論理) の集合、となります。</p>
<p>できることはほぼ同じですが、以下のような特徴で分けています。</p>
<p>CPLD</p>
<ul class="simple">
<li><p>フラッシュメモリを内蔵し、電源を入れるとすぐ使える。</p></li>
<li><p>回路規模は小さめ。</p></li>
<li><p>基本的に論理回路しか入ってない。</p></li>
<li><p>動作速度が比較的高い。</p></li>
<li><p>構造上、XOR が少し苦手。</p></li>
</ul>
<p>FPGA</p>
<ul class="simple">
<li><p>動作のプログラムは揮発性のメモリに格納されるので、電源を切ると内容が失われる。そのため別途フラッシュメモリが必要。</p></li>
<li><p>回路規模はかなり大きい。</p></li>
<li><p>高機能 (乗算用ハードウェアが入っていたり、メモリが入っていたりする) 。</p></li>
<li><p>動作速度は今ではだいぶ高くなってきた。</p></li>
</ul>
<p>いずれも D フリップフロップと組み合わせ回路がセットになっており、その入力をプログラムするような形です。このセットがデバイスの中に多数組み込まれ、相互に接続できるよう配線とスイッチも同様に多数用意されます。</p>
<p>CPLD と FPGA の間の大きな違いは組み合わせ回路の構成です。CPLD は大量の AND と多入力 OR を組み合わせていますが (実際には NOT も入ります) 、FPGA は AND 、OR に縛られない LUT (LookUp Table) を使用します。たとえば４入力の AND 、４入力の OR に限らず、\&quot;4\&quot; 等の任意の数値と一致したときに H を出力する、というようなことも簡単にできるよう、より柔軟な構造になっています。</p>
</div>
<div class="section" id="hdl">
<h3><span class="section-number">3.1. </span>HDL<a class="headerlink" href="#hdl" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ディジタル回路を組み込んだ IC や LSI の開発では、初期には AND 、OR 、NOT 、フリップフロップを CAD 上で回路図のように配置して接続していました。</p>
<p>こういった CAD は、IC 、LSI メーカ毎に異なるため、たとえば完成したデータを違う LSI メーカで製造しなければいけなくなったとき、互換性が無いため入力＆確認し直しが必要になっていました。</p>
<p>こういった状況を避けるために、IC 、LSI の開発も、ソフトウェアのようにテキストで行おうという動きがでてきました。このジャンルの言語は HDL  (Hardware Description Language) と呼ばれます。</p>
<p>ソフトウェアと同様、HDL も様々なものが開発されましたが、現在の主流は VerilogHDL と VHDL です。</p>
<p>VerilogHDL、VHDL は FPGA だけでなく、IC、LSI の開発にも利用されます。</p>
</div>
<div class="section" id="veriloghdl-vhdl">
<h3><span class="section-number">3.2. </span>VerilogHDL と VHDL<a class="headerlink" href="#veriloghdl-vhdl" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>各言語の特徴を以下に示します (筆者の独断と偏見を含む)</p>
<p>VerilogHDL</p>
<ul class="simple">
<li><p>民間主導- ツールメーカが開発した。</p></li>
<li><p>比較的便利な記述ができるようになっている。</p></li>
<li><p>文法上記述ミスが許容される傾向がある＝ デバッグ時に大変なことが多い。</p></li>
<li><p>日本でのシェアは、こちらがかすかに多いかもしれない。</p></li>
<li><p>C 言語に近い、と評されることがあるものの、上記のような動きがあることから、むしろ BASIC の方が近いと感じる。</p></li>
<li><p>無料のシミュレータがあるため、特に趣味の範囲での人気は VHDL より高い模様。</p></li>
</ul>
<p>VHDL</p>
<ul class="simple">
<li><p>米国国防省主導- ソフトウェアのプログラミング言語をベースに策定</p></li>
<li><p>融通が利かず、あまり高機能でない。コード量は多くなる傾向かもしれない。</p></li>
<li><p>海外でのシェアは、こちらがかすかに多いかもしれない。</p></li>
<li><p>BASIC ににたキーワードもあるものの、文法エラーの検出の強さは C 言語に近い。</p></li>
</ul>
</div>
<div class="section" id="id1">
<h3><span class="section-number">3.3. </span>高位合成<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>HDL は一般にクロックや信号の衝突などソフトウェアとは異なる考え方が必要になります。それだけ、HDL のプログラマはソフトウェアのプログラマに比べ人口が少ないです。</p>
<p>それでも FPGA に魅力を感じている人々が長年ツールを開発し続け、2014年頃からそれが安価に入手できるようになりました。</p>
<p>Xilinx 社は HLS という名前で、C 言語での FPGA 開発ができるようになっています。</p>
<p>Intel 社 ( Altera 社を買収 )、Xilinx 社 <a class="footnote-reference brackets" href="#f1" id="id2">1</a> とも OpenCL 対応のデータ処理向けの開発環境をそろえています。</p>
<p>より高レベル (ハードウェアから遠いという意味で) な言語によるアプローチもあり、これらは高位合成と呼ばれています。</p>
<p>現在は Java 、Python などの言語での FPGA 開発が可能になっています。</p>
<p>ただし FPGA に組み込む回路全てをこれらの言語だけで開発できないパターンもあり、そういった箇所には引き続き VerilogHDL、VHDL が使われます。</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>FPGA メーカーは現在はあまり多くなく、Intel 社と Xilinx 社でほぼ寡占、Lattice 社が単独3位のようなポジションで、あとは小規模なメーカーがいくつか。</p>
</dd>
</dl>
</div>
</div>
<span id="document-04_vhdl"></span><div class="section" id="vhdl">
<h2><span class="section-number">4. </span>VHDL<a class="headerlink" href="#vhdl" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id1">
<h3><span class="section-number">4.1. </span>基本形<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>VHDL のソースコードは、基本的には以下のような形です。</p>
<div class="figure align-center">
<img alt="_images/figure01.png" src="_images/figure01.png" />
</div>
<p>これがテンプレートとなります。コードを記述するときは、この中の x、y、３つの枠の中を、目的に合わせて書き換えます。</p>
<p>ここで x は entity 名、y は architecture 名です。ポート宣言はこの entity が外部とやりとりする信号 (たとえば実際のデバイスのピン) を宣言します。</p>
<p>entity 名はこの回路に対する自由な名前 (たとえば機能から名付けるなど) 、architecture 名はどの entity に対しても同じ「rtl」という名前をつけておけば通常問題ありません。</p>
<p>これらは以下のようなイメージになります。</p>
<div class="figure align-center">
<img alt="_images/figure02.png" src="_images/figure02.png" />
</div>
<p>ファイルにはいくつかの entity 、architecture を含めることができますが、この実習では一つのファイルに一つの entity 、architecture を保存し、ファイル名は entity 名に合わせて設定してください。</p>
<div class="figure align-center">
<img alt="_images/figure03.png" src="_images/figure03.png" />
</div>
<div class="section" id="id2">
<h4><span class="section-number">4.1.1. </span>解説<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="section" id="entity">
<h5><span class="section-number">4.1.1.1. </span>entity とその周辺<a class="headerlink" href="#entity" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>entity と architecture はいずれもそれ単体では何もできません。わざわざ分かれているところから想像できるとおり、同じ entity に対して異なる architecture を適用させることもできますが、この授業では扱いません。</p>
<p>また entity 、architecture が動作するためには、entity の前にある４行のライブラリ宣言が必要です。</p>
<p>ここでは ieee の 1164 、arith 、unsigned を呼び出しています。この授業ではこの組み合わせを使用しますので、この４行のライブラリ宣言もそのまま使用します。</p>
<p>C 言語のインクルードファイルの宣言などと異なり、ファイルに複数の entity 、architecture を記述する場合、ライブラリ宣言は entity 毎に宣言し直す必要があります。４個の entity を記述していれば、その都度、合計４回のライブラリ宣言が必要です。</p>
</div>
</div>
<div class="section" id="id3">
<h4><span class="section-number">4.1.2. </span>ファイルとの関係<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>一般にファイル名と entity 名をそろえ、拡張子は「.vhd」とします。</p>
<p>一つのファイルに複数の entity 、architecture を記述することもできますが、その際はそれに対応した use 、library の宣言も必要です。</p>
<p>この授業では、一つのファイルに一つの entity 、architecture とするのがよいでしょう。</p>
<p>またライブラリのうち unsigned は名前から想像できるとおり符号なしの演算を行います。符号付きの演算を行いたい場合は代わりに signed を呼び出します。一つの entity 、architecture 内では混在はできません。</p>
</div>
</div>
<div class="section" id="id4">
<h3><span class="section-number">4.2. </span>信号の種類<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>信号は、ソフトウェアで言う変数と同様のイメージから考えてください。</p>
<p>たとえば C 言語であれば char 、int 、float 等があるように、VHDL でもライブラリを読み込むことで以下のような信号が扱えます。</p>
<div class="section" id="std-logic">
<h4><span class="section-number">4.2.1. </span>std_logic<a class="headerlink" href="#std-logic" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>1bit の信号。通常使用する値は 0、1、Z です。</p>
<p>直値を扱う場合、1bit 分ずつシングルクオートで括ります。</p>
<p>0、1 は信号の L レベル、 H レベルに対応します。</p>
<p>Z は「ハイインピーダンス」で、その信号が無い、何もつながっていない状態を作ります。この授業の範囲では使いません。</p>
<p>例</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="p">&#39;</span> <span class="mi">0</span> <span class="p">&#39;</span> <span class="p">,</span> <span class="p">&#39;</span> <span class="mi">1</span> <span class="p">&#39;</span> <span class="p">,</span> <span class="na">&#39;Z</span> <span class="p">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="std-logic-vector">
<h4><span class="section-number">4.2.2. </span>std_logic_vector<a class="headerlink" href="#std-logic-vector" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>std_logic を束ねたもので、任意のビット数を扱うことができます。</p>
<p>各ビットに代入できる値は std_logic と同じです。</p>
<p>束ねるビット数は宣言時に決めておきます。たとえば１０進数で０～１００までを扱うには 7bit 必要ですので、７本の std_logic を束ねるため、以下のような形式になります。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">6</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>この場合、MSB <a class="footnote-reference brackets" href="#f41" id="id5">1</a> が bit 6 、LSB <a class="footnote-reference brackets" href="#f42" id="id6">2</a> が bit 0 という宣言になります。ここに代入する値は、たとえば１０進数の１０であれば</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;0001010&quot;</span>
</pre></div>
</div>
<p>というふうにダブルクオーテーションで括ります。左が bit6 、右が bit0 です。代入する値は、代入先の信号とビット幅が一致している必要があります <a class="footnote-reference brackets" href="#f43" id="id7">3</a> 。</p>
<p>例</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;0000&quot;</span><span class="p">,</span> <span class="s">&quot;010101010&quot;</span><span class="p">,</span> <span class="s">&quot;00Z00Z&quot;</span>
</pre></div>
</div>
<p>括弧 () でビット番号を指定することで、std_logic として 1bit 抜き出して扱うことができます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>std_logic_vector(0 to 6) という宣言の仕方もありますが、ソースやプロジェクトの中で混在させるのはバグのもとになるので通常はどちらかに統一します。</p>
<p>この授業では downto に統一します。</p>
<p>図の上を MSB、下を LSB とした場合、downto と to の関係は次の図のようになります。</p>
<div class="figure align-center">
<img alt="_images/figure04.png" src="_images/figure04.png" />
</div>
</div>
</div>
<div class="section" id="integer">
<h4><span class="section-number">4.2.3. </span>integer<a class="headerlink" href="#integer" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>10 進数を直接扱います。bit は意識しません。std_logic や std_logic_vector とは直接接続することはできません。</p>
</div>
</div>
<div class="section" id="id8">
<h3><span class="section-number">4.3. </span>ポート宣言<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ポート宣言では、この entity  (回路ブロック) が外部とやりとりする信号を定義します。</p>
<p>複数の信号を定義でき、それぞれ以下のような形です。</p>
<p>ポート名: 方向信号型</p>
<p>定義の区切りにセミコロンが必要です。定義の終わりを示すものでは無いので、最後の定義ではセミコロンは書きません。</p>
<p>例</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">extsignal1</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="n">extsignal2</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">extsignal3</span> <span class="o">:</span> <span class="k">inout</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="n">extsignal4</span> <span class="o">:</span> <span class="k">buffer</span> <span class="kt">std_logic</span>
</pre></div>
</div>
<p>ポート名は任意の名前をつけ、architecture 内からその信号にアクセスできます。</p>
<p>方向については上記の４パターンがあります。</p>
<dl class="simple">
<dt>in</dt><dd><p>この entity への入力です。architecture 内では読むことしかできません。</p>
</dd>
<dt>out</dt><dd><p>この entity からの出力です。architecture 内で書き込むことしかできません。</p>
</dd>
<dt>inout</dt><dd><p>入出力両方ができます。architecture 内では読み書きができますが、信号が衝突すると電気的に短絡 (ショート) となるため、エラーとなります。エラーにならない対応はこの授業では扱いません。</p>
</dd>
<dt>buffer</dt><dd><p>この entity からの出力です。out との違いは信号の再利用ができることですが、制約もあるので使うのは避けた方がよいでしょう。</p>
</dd>
</dl>
<p>それぞれのイメージを図に示します。読み書きは他の signal へ、または signal からの「代入」と読み替えてもよいでしょう。</p>
<p>buffer と inout はこの授業では使用しません。</p>
<div class="figure align-center">
<img alt="_images/figure05.png" src="_images/figure05.png" />
</div>
</div>
<div class="section" id="id9">
<h3><span class="section-number">4.4. </span>シグナル宣言<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>アーキテクチャの中で使用する信号を宣言します。アーキテクチャの記述の中で、begin の前に行います (begin より後には宣言できません) 。</p>
<p>例</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">signal</span> <span class="n">intsignal1</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">signal</span> <span class="n">intsignal2</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">signal</span> <span class="n">intsignal3</span> <span class="o">:</span> <span class="kt">integer</span><span class="p">;</span>
<span class="k">signal</span> <span class="n">intsignal4</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
</pre></div>
</div>
<p>&quot;signal&quot; キーワードの後に、ポート宣言と同様に任意の名前をつけます。信号の種類もポート宣言と同様です。</p>
<p>アーキテクチャ内部でのみ使用するので、方向は記述しません。</p>
<p>また全ての宣言で末尾はセミコロンで閉じます。</p>
</div>
<div class="section" id="id10">
<h3><span class="section-number">4.5. </span>値の代入<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>代入は &quot;&lt;=&quot; で行います。</p>
<p>例 (１)</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">intsignal1</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="n">intsignal4</span> <span class="o">&lt;=</span> <span class="n">intsignal1</span><span class="p">;</span>
<span class="n">intsignal2</span> <span class="o">&lt;=</span> <span class="s">&quot;0000&quot;</span><span class="p">;</span>
<span class="n">intsignal3</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span>
</pre></div>
</div>
<p>std_logic_vector の場合は値の扱い方にバリエーションがあるのでここで解説します。</p>
<p>合計したビット数が代入先の信号に一致していれば、＆で結合できます。</p>
<p>括弧でビットを指定すれば、std_logic を代入したり、参照したりできます。</p>
</div>
<div class="section" id="variable">
<h3><span class="section-number">4.6. </span>もう一つの信号 variable と代入<a class="headerlink" href="#variable" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>VHDL には port 、signal の他にもう一つ、variable という信号のタイプがあります。</p>
<p>variable は後述する process 文の中でのみ使用でき、信号のタイプは他と同様 std_logic 等を使うことができます。</p>
<p>代入には := を使います。</p>
<p>variable はこの授業では扱いません。</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f41"><span class="brackets"><a class="fn-backref" href="#id5">1</a></span></dt>
<dd><p>変化することにより全体の値が大きく変化するビット</p>
</dd>
<dt class="label" id="f42"><span class="brackets"><a class="fn-backref" href="#id6">2</a></span></dt>
<dd><p>変化から値全体の変化が一番小さいビット</p>
</dd>
<dt class="label" id="f43"><span class="brackets"><a class="fn-backref" href="#id7">3</a></span></dt>
<dd><p>ビット幅が一致していなくてもツール上エラーにならない場合があり、発見しづらいバグになりやすいです。</p>
</dd>
</dl>
</div>
</div>
<span id="document-05_try"></span><div class="section" id="id1">
<h2><span class="section-number">5. </span>演習<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id2">
<h3><span class="section-number">5.1. </span>注意事項<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p>開発環境 Quatus II のプロジェクトは、実習項目毎に作り直してください。流用するとトラブルの元になります。</p></li>
<li><p>Quatus II の中で日本語を入力するのは避けましょう。こちらもトラブルの元になります。</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3><span class="section-number">5.2. </span>論理演算<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id4">
<h4><span class="section-number">5.2.1. </span>演習<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl01</p>
<p>スイッチ入力に対して論理演算を行い、結果を LED に出力します。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl01</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">sw1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led2</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led3</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led4</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led5</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl01</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl01</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">sw1</span><span class="p">;</span>
  <span class="n">led2</span> <span class="o">&lt;=</span> <span class="n">sw2</span><span class="p">;</span>
  <span class="n">led3</span> <span class="o">&lt;=</span> <span class="n">sw1</span> <span class="k">and</span> <span class="n">sw2</span><span class="p">;</span>
  <span class="n">led4</span> <span class="o">&lt;=</span> <span class="n">sw1</span> <span class="k">or</span> <span class="n">sw2</span><span class="p">;</span>
  <span class="n">led5</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw1</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>このコードで出力される回路は図のようなものになります。</p>
<div class="figure align-center">
<img alt="_images/figure06.png" src="_images/figure06.png" />
</div>
<p>スイッチは基板奥の方 (７セグ LED 側) に倒すと H 、手前で L のレベルになります。
LED に対してはデバイスから H を与えると消灯、L を与えると点灯します。
たとえば led1 はスイッチ１番を奥に倒すと消灯、手前に倒すと点灯します。led5 は逆の点灯の仕方になります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>この授業で使っている基板は2つのリビジョンがあり、リビジョン間でスイッチの極性が異なります。</p>
<p>期待した動きをしないときは、これが原因の場合があります。cd</p>
</div>
</div>
</div>
<div class="section" id="id5">
<h3><span class="section-number">5.3. </span>数値演算<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id6">
<h4><span class="section-number">5.3.1. </span>演習<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl02</p>
<p>スイッチ入力に対して数値演算を行い、LED に表示します。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl02</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">sw1</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw3</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw4</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw5</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw6</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw7</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw8</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>

    <span class="n">led1</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led2</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led3</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led4</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led5</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led6</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led7</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led8</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>

    <span class="n">sled1a</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1b</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1c</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1d</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1e</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1f</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1g</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2a</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2b</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2c</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2d</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2e</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2f</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled2g</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl02</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl02</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">s_sw1</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw2</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw3</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw4</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw5</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw6</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw7</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s_sw8</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">sw</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">8</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">signal</span> <span class="n">add</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">sub</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">signal</span> <span class="n">led71</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">6</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">led72</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">6</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="c1">-- fixed polarity</span>
  <span class="c1">-- revision 2</span>
  <span class="c1">-- s_sw1 &lt;= sw1;</span>
  <span class="c1">-- s_sw2 &lt;= sw2;</span>
  <span class="c1">-- s_sw3 &lt;= sw3;</span>
  <span class="c1">-- s_sw4 &lt;= sw4;</span>
  <span class="c1">-- s_sw5 &lt;= sw5;</span>
  <span class="c1">-- s_sw6 &lt;= sw6;</span>
  <span class="c1">-- s_sw7 &lt;= sw7;</span>
  <span class="c1">-- s_sw8 &lt;= sw8;</span>
  <span class="c1">-- revision 1 (no revision)</span>
  <span class="n">s_sw1</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw1</span><span class="p">;</span>
  <span class="n">s_sw2</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw2</span><span class="p">;</span>
  <span class="n">s_sw3</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw3</span><span class="p">;</span>
  <span class="n">s_sw4</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw4</span><span class="p">;</span>
  <span class="n">s_sw5</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw5</span><span class="p">;</span>
  <span class="n">s_sw6</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw6</span><span class="p">;</span>
  <span class="n">s_sw7</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw7</span><span class="p">;</span>
  <span class="n">s_sw8</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sw8</span><span class="p">;</span>

  <span class="c1">-- left 4 switches &amp; right 4 switches</span>
  <span class="c1">-- left switch is MSB</span>
  <span class="n">sw</span> <span class="o">&lt;=</span> <span class="n">s_sw1</span> <span class="o">&amp;</span> <span class="n">s_sw2</span> <span class="o">&amp;</span> <span class="n">s_sw3</span> <span class="o">&amp;</span> <span class="n">s_sw4</span> <span class="o">&amp;</span> <span class="n">s_sw5</span> <span class="o">&amp;</span> <span class="n">s_sw6</span> <span class="o">&amp;</span> <span class="n">s_sw7</span> <span class="o">&amp;</span> <span class="n">s_sw8</span><span class="p">;</span>

  <span class="n">add</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sw</span><span class="p">(</span><span class="mi">8</span> <span class="k">downto</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">sw</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">sub</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sw</span><span class="p">(</span><span class="mi">8</span> <span class="k">downto</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="n">sw</span><span class="p">(</span><span class="mi">4</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>

  <span class="c1">-- make 7 seg LED bit map</span>
  <span class="n">led71</span> <span class="o">&lt;=</span> <span class="s">&quot;0010000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;1001&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;1000&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1111000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0111&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0110&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0010010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0101&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0011001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0100&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0110000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0011&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0100100&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0010&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1111001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0001&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&quot;0000&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000110&quot;</span> <span class="p">;</span>
  <span class="n">led72</span> <span class="o">&lt;=</span> <span class="s">&quot;0010000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;1001&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;1000&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1111000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0111&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0110&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0010010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0101&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0011001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0100&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0110000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0011&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0100100&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0010&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1111001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0001&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;1000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;0000&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="s">&quot;0000110&quot;</span> <span class="p">;</span>

  <span class="c1">-- map to pin</span>
  <span class="n">sled1a</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">sled1b</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">sled1c</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">sled1d</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">sled1e</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">sled1f</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">sled1g</span> <span class="o">&lt;=</span> <span class="n">led71</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">sled2a</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">sled2b</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">sled2c</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">sled2d</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">sled2e</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">sled2f</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">sled2g</span> <span class="o">&lt;=</span> <span class="n">led72</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>

  <span class="c1">-- debug</span>
  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">led2</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">led3</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">led4</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">led5</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sub</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">led6</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sub</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">led7</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">led8</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>スイッチの上位 (基板上左側) ４ビットと下位 (右側) ４ビットの演算を行います。LED の上位に加算の結果、下位に減算の結果が２進数で表示されます。</p>
<p>たとえばスイッチを８から１まで、10100001  (1=ON, 0=OFF) とした場合、結果 (= LED の点灯パターン) は 10111001 となります。</p>
<p>また７セグ LED にも結果を表示します。７セグ LED は 0 ～ 9 までの表示を行います。</p>
<div class="figure align-center">
<img alt="_images/figure07.png" src="_images/figure07.png" />
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>符号無し 4 ビット演算です。</p>
<p>このコードでは、10 以上の数値 ( 具体的には 0 ～ 9 以外 ) は ７セグ LED の表示は E になります。</p>
</div>
</div>
</div>
<div class="section" id="when-else">
<h3><span class="section-number">5.4. </span>条件分岐 when ～ else ～<a class="headerlink" href="#when-else" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id7">
<h4><span class="section-number">5.4.1. </span>演習<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl03</p>
<p>条件分岐の書き方の一つ、when ～ else ～ の例です。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl03</span> <span class="k">is</span>
  <span class="k">port</span><span class="p">(</span>
    <span class="n">sw1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw8</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl03</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl03</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">sw2</span> <span class="k">when</span> <span class="p">(</span><span class="n">sw8</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span>
     <span class="k">else</span> <span class="n">sw1</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>sw8 を H レベルにしておくと、LED1 は sw2 の操作に従って点灯します。</p>
<p>sw8 が L レベルの場合は、LED1 は sw1 の操作に従って点灯します。</p>
<p>このコードから生成される回路のイメージは次の図の通りです。</p>
<div class="figure align-center">
<img alt="_images/figure08.png" src="_images/figure08.png" />
</div>
<p>この記述ではいくつでも分岐させることができます。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">ans</span> <span class="o">&lt;=</span> <span class="n">x1</span> <span class="k">when</span> <span class="p">(</span><span class="n">y1</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span>
  <span class="k">else</span> <span class="n">x2</span> <span class="k">when</span> <span class="p">(</span><span class="n">y2</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span>
  <span class="k">else</span> <span class="n">x3</span> <span class="k">when</span> <span class="p">(</span><span class="n">y3</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span>
  <span class="k">else</span> <span class="n">x4</span> <span class="k">when</span> <span class="p">(</span><span class="n">y4</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span>
  <span class="k">else</span> <span class="n">x5</span><span class="p">;</span>
</pre></div>
</div>
<p>ただし、判定は記述した順番に行われます。この例でたとえば y1 ～ y4 全てが 1 だった場合、y1 の条件が採用されます (プライオリティエンコーダ＝選択肢に優先順位のあるセレクタ) 。</p>
</div>
</div>
<div class="section" id="with-select-when">
<h3><span class="section-number">5.5. </span>条件分岐 with ～ select ～ when ～<a class="headerlink" href="#with-select-when" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id8">
<h4><span class="section-number">5.5.1. </span>演習<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl04</p>
<p>条件分岐の書き方の一つ、with ～ select ～ when ～ の例です。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl04</span> <span class="k">is</span>
  <span class="k">port</span><span class="p">(</span>
    <span class="n">sw1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw3</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw7</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw8</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl04</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl04</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">sw</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">sw</span> <span class="o">&lt;=</span> <span class="n">sw8</span> <span class="o">&amp;</span> <span class="n">sw7</span><span class="p">;</span>
  <span class="k">with</span> <span class="n">sw</span> <span class="k">select</span> <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">sw3</span> <span class="k">when</span> <span class="s">&quot;11&quot;</span><span class="p">,</span>
                         <span class="n">sw2</span> <span class="k">when</span> <span class="s">&quot;10&quot;</span><span class="p">,</span>
                         <span class="n">sw1</span> <span class="k">when</span> <span class="s">&quot;01&quot;</span><span class="p">,</span>
                         <span class="sc">&#39;0&#39;</span> <span class="k">when</span> <span class="k">others</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>sw7 と sw8 の設定により、LED の点滅を制御できるスイッチを切り替えられる回路です。</p>
<p>このコードから生成される回路のイメージは次の通りです。</p>
<div class="figure align-center">
<img alt="_images/figure09.png" src="_images/figure09.png" />
</div>
<p>中央のブロックはセレクタで、上から入力される値がブロック中の値と一致すると、その箇所の信号が出力されます。</p>
<p>選択肢に優先順位がある場合は when ～ else ～、ない場合は with ～ select ～ when ～ を使います。</p>
</div>
</div>
<div class="section" id="process">
<h3><span class="section-number">5.6. </span>process 文<a class="headerlink" href="#process" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>AND、OR、NOT などの組み合わせ回路や単純な条件分岐であればこれまでの内容で対応できますが、フリップフロップなどを組み合わせた順序回路を記述するには、process 文を使用します。</p>
<p>ヒント</p>
<p>フリップフロップ専用の記述ではありませんが、フリップフロップを使用する箇所のみ process 文を使うようにしていると、慣れていないうちはトラブルを避けやすくなります。</p>
<p>基本的な構成は以下の通りです。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>LABEL: process (SENSITIVITY-LIST)
begin
  ～ EXPRESSION ～
end process;
</pre></div>
</div>
<p>ラベル(LABEL) を付加するかどうかは任意ですが、識別のために固有の名前をつけておくのがよいでしょう。</p>
<p>センシティビティリスト(SENSITIVITY-LIST) は、この process 文を動作させるトリガになる信号のリストを記述します。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>センシティビティリストに書いた信号は「トリガ」と書きましたが、その信号が変化した時に必ず process 文の内容が実行されるという話ではなく、その信号が変化したときに、process 文の一番最初の if ～ then ～ elsif ～ else ～ end if の条件で動作する、という点を覚えておきましょう。</p>
</div>
<p>信号名はカンマで区切ります。</p>
<p>式(EXPRESSION) の部分には実際の動作を記述します。ただし条件分岐は、これまでの when ～ else ～ や with ～ select ～ when ～ は使用できません。後ほどでてくる if 文や case 文を使用します (逆に if 文や case 文は process 文の外では使用できません) 。</p>
<table class="docutils align-default" id="id36">
<caption><span class="caption-text">組み合わせ</span><a class="headerlink" href="#id36" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>process 文の</p></th>
<th class="head"><p>when ～ else ～</p></th>
<th class="head"><p>with ～ select ～ when ～</p></th>
<th class="head"><p>if ～ elsif ～ endif</p></th>
<th class="head"><p>case ～ end case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>外</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>×</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-odd"><td><p>中</p></td>
<td><p>×</p></td>
<td><p>×</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="if">
<h3><span class="section-number">5.7. </span>フリップフロップの基本と if 文<a class="headerlink" href="#if" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フリップフロップは主に D 型、SR 型、JK 型、T 型があります。これらを VHDL で記述するときは一般に process 文を使用します。</p>
<p>フリップフロップのリセットが非同期式の場合、D フリップフロップは以下のように記述します。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="nc">D_FF</span><span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">clock</span><span class="p">)</span>
<span class="k">begin</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">reset</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">q</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="k">elsif</span> <span class="p">(</span><span class="n">clock</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clock</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<p>この例では、すべての信号は std_logic で定義されているとします。</p>
<p>入力データは信号は d 、出力データ信号は q としています。</p>
<p>reset に H レベルの信号を与えるとリセット動作として、q を L レベルにセットしています。</p>
<p>クロック信号 clock が H へ変化すると、q へ d を代入します。</p>
<div class="figure align-center">
<img alt="_images/figure12.png" src="_images/figure12.png" />
</div>
<p>動作例を以下に示します。</p>
<div class="figure align-center">
<img alt="_images/figure10.png" src="_images/figure10.png" />
</div>
<p>a の期間では reset = '1' が成り立つので q &lt;= '0' が実行され続けます。</p>
<p>b のタイミングでは clock'event and clock = '1' が成り立ちます。これは、clock が変化したこと (clock'event) と clock = '1' の組み合わせで、clock が 0 から 1 に変化したときに成り立つ、という記述の仕方です。このとき q &lt;= d が実行されます。d が 1 なので最終的には q は 1 になります。</p>
<p>c のタイミングも b のタイミング同様、clock が 0 から 1 に変化したことが成り立っています。q には d の値 0 が代入されます。</p>
<p>d の期間では e や f のタイミングで clock'event が成り立っていますが、if 文 (後述) で reset = '1' が先に記述されているため、e 、f は無視され、q には 0 が出力され続けます。</p>
<p>ちなみに FPGA が起動したとき、フリップフロップの値が H 、L どちらになっているかは決まっていません。そのため図で q はリセットがかかるまではどちらの値かわかりません (不定) 。</p>
<div class="section" id="id9">
<h4><span class="section-number">5.7.1. </span>シミュレーション<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>順序回路の動作確認にはシミュレータが役に立ちます。ここでシミュレーションにより上記の動作を確認します。</p>
<p>D:\Altera\(学籍番号) に vhdl20 というフォルダを作ります。</p>
<p>Web ブラウザで <a class="reference external" href="http://vhdl.cottonrose.jp/2016/">http://vhdl.cottonrose.jp/2016/</a> を開き、vhdl20.vhd をダウンロードし、先ほどのフォルダにダウンロードします。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ダウンロードしたファイルが読み取り専用になっていることがあります。</p>
</div>
<p>別冊「Altera開発環境（QuartusII）使用マニュアル」の 21 ページからのシミュレーションの手順を行います。</p>
<p>34 ページまで実行すると、上記のような波形が見られます (波形の赤いラインは不定を表します)。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>自分自身への代入について</p>
<p>process 文の中の if 文の中で、clock'event and clock = '1' の条件の中では、宣言されている signal や variable に自分自身を代入できます。</p>
<p>例えば、a &lt;= a; はこのままでは無意味なコードですが、正常なものです。これは、この代入動作がクロックの変化点のみ行われるのがポイントです。</p>
<p>これを応用すると、a &lt;= not a; であればクロックの変化点事に反転、a &lt;= a + 1; であればカウントアップしていく動きになります。</p>
<p>これが process 文の外、clock'event and clock = '1' の外では、エラーになるか、予測できない動作になります。エラーにならなかった場合、例えば a &lt;= not a; はデバイスの限界速度で反転を繰り返す信号を生成しますが、スイッチ動作が多すぎて電流消費、発熱から、何が起きるかわかりません。</p>
</div>
</div>
<div class="section" id="id10">
<h4><span class="section-number">5.7.2. </span>同期、非同期<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>「非同期」動作は、クロックによらず動作する箇所、「同期」動作はクロックの変化点に合わせて動作することを示しています。</p>
<p>先ほどのサンプルでは、リセットは非同期動作 (特にこの場合は「非同期リセット」とも呼ばれる) 、データの保持は同期動作としています。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>データをクロックに同期して保持するものを一般にフリップフロップ、同期せずに保持するものをラッチと呼びます。</p>
<p>これは「ディジタルコンピューティングシステム」p54 に書かれていることと逆ですが、会社などの組織毎に異なる場合があるので注意が必要です。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>FPGA に実装する回路において、一般にラッチは使用するべきではないとされています。</p>
<p>フリップフロップを使った方が動作が予測しやすいため、デバイス自体にフリップフロップが組み込まれています。それに対しラッチは大規模回路では動作の予測が難しく、バグの元になりやすいため、です。</p>
<p>慣れないうちは、できる限りすべてのフリップフロップは同じクロックで動作するようにし、動作を始める前にはすべて非同期リセットを行うように組むと失敗が少なくなります。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>「ディジタル回路」は信号レベル (縦軸) を離散的に扱います。「同期回路」は時間軸を離散的に扱うための手法と考えられます。「非同期回路」は時間軸に不確定な要因を持つことになるため、動作の安定性に影響します。</p>
<p>この授業の実習では、その実習で使用するすべてのフリップフロップは同じクロックで動作させるようにします。</p>
<p>これらを守るためには、上の D フリップフロップの例のようなセンシティビティリスト (信号名は回路に合わせる) 、if 文の構成 (非同期リセットとクロックの動作しかなく、それ以上はその if 、elsif の中に書き足していく) を基本にしていきます。</p>
</div>
</div>
<div class="section" id="id11">
<h4><span class="section-number">5.7.3. </span>if 文<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件分岐の基本的なもので、基本的な形は以下の通りです。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>if (CONDITION) then
  ～ EXPRESSION ～
end if;
</pre></div>
</div>
<p>条件(CONDITION) が真であれば、処理(EXPRESSION) が実行されます。
複数の条件ごとに処理を分ける場合は以下のようになります。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>if (CONDITION_A) then
  ～ EXPRESSION_A ～
elsif (CONDITION_B) then
  ～ EXPRESSION_B ～
elsif (CONDITION_C) then
  ～ EXPRESSION_C ～
else
  ～ EXPRESSION_OTHER ～
end if;
</pre></div>
</div>
<p>条件 A (CONDITION-A) が真であれば処理 A (EXPRESSION-A) を実行、それ以外で条件 B (CONDITION-B) が真であれば処理 B (EXPRESSION-B) 、それ以外で条件 C (CONDITION-C) が真であれば処理 C (EXPRESSION-C)、それ以外ではその他の処理(EXPRESSION-OTHERS) を実行します。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>一般のプログラミング言語と異なり、「else if」ではなく「elsif」と書きます。</p>
</div>
<p>条件の書き方は、たとえば一致判定では</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">reset</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span>
</pre></div>
</div>
<p>不一致判定は</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">reset</span> <span class="o">/=</span> <span class="sc">&#39;0&#39;</span>
</pre></div>
</div>
<p>数値の大小の比較では、</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">&gt;=</span> <span class="s">&quot;1010&quot;</span>
</pre></div>
</div>
<p>となります。</p>
<p>条件は複数組み合わせることができ、そのときは and 、or 、not も使用できます。</p>
<p>たとえば</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span> <span class="k">and</span> <span class="n">b</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span>
</pre></div>
</div>
<p>とすれば、２つの条件が満たされた場合、と判定されます。
クロックの変化点での動作、つまり同期動作について括る場合の条件は、</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">clock</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clock</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span>
</pre></div>
</div>
<p>が一般的となります。これは clock の変化点と、clock が H という２つの条件の AND となります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>上記のような、クロックの変化点での動作の記述は、一つの if 文で複数書いても文法上は問題ありませんが、実際のデバイス上でそのような動作は行うことができません。</p>
</div>
<p>一般に process 文の最初の if 文の構成は最大で</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (set, reset, clock)
begin
  if (reset = &#39;1&#39;) then
    ～
  elsif (set = &#39;1&#39;) then
    ～
  elsif (clock&#39;event and clock = &#39;1&#39;) then
    ～
  end if ;
end process;
</pre></div>
</div>
<p>となります。</p>
<p>リセット時、セット (プリセット) 時、その他通常動作時を同じレベルで設定しています。</p>
<p>以下の書き方は許容されますが、理解できていないうちは行うべきではありません。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (clock)
begin
  if (clock&#39;event and clock = &#39;1&#39;) then
    ～
  end if;
end process;
process (clock)
begin
  if (clock&#39;event and clock = &#39;0&#39;) then
    ～
  end if;
end process;
</pre></div>
</div>
<p>同じクロックで動作する書き方ですが、1 = クロックの立ち上がりと 0 = クロックの立ち下がりが混在しています。この２つの process 文の間でデータのやりとりがあるとき、デバイス上での動作条件が厳しくなります。</p>
<p>以下の書き方は実機には基本的には組み込めません。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (clock)
begin
  if (clock&#39;event and clock = &#39;1&#39;) then
    ～
  elsif (clock&#39;event and clock = &#39;0&#39;) then
    ～
  end if;
end process;
</pre></div>
</div>
<p>同じ process 文内で、同じクロックの 1 = クロックの立ち上がりと 0 = クロックの立ち下がりが混在しています。同じ signal に対してこのような動作は指示できません。それぞれの処理に異なる signal を入れれば組み込むことはできますが、一つ前の例と同様使うべきではありません。</p>
</div>
<div class="section" id="id12">
<h4><span class="section-number">5.7.4. </span>マルチソース<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>HDL では、基本的に全ての行が、常に「同時」に動作していると考える必要があります。この点が、ソースコードを逐次解釈していくソフトウェアと大きく異なる点です。</p>
<p>これにより、signal や port への値の代入の仕方に制限があります。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">test</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">a</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">a</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>ソフトウェアであればこの場合、a に 0 が代入された後でさらに a に 1 が代入されます。
しかし HDL の場合、0 と 1 の代入は同時に行おうとし、論理合成の段階でエラーとなります (エラーメッセージには multi source という言葉が含まれます) 。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">x</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">d1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">d2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">clk</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">q</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">)</span> <span class="p">;</span>
<span class="k">end</span> <span class="nc">x</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">x</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">a</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">a_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clk</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">d1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">b_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clk</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">d2</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">;</span>

<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>別々の process 文で動作させていても、同じ signal に代入しようとしているため、両方の条件が必ず衝突しない書き方出ない限り論理合成でエラーになります (そしてそのように書いたとしても不具合の修正なので書き換えているうちに条件が崩れ multi source のエラーになりやすいです) 。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">x</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">d1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">d2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">clk</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">q</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">)</span> <span class="p">;</span>
<span class="k">end</span> <span class="nc">x</span> <span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">x</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">a</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">a</span> <span class="n">proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clk</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">d1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">d2</span><span class="p">;</span>
  <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">;</span>

<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>このような process 文での順序回路と、通常の組み合わせ回路でも同様です。</p>
</div>
<div class="section" id="process-if">
<h4><span class="section-number">5.7.5. </span>process 文、if 文によるフリップフロップの記述のお約束<a class="headerlink" href="#process-if" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>この教科書ではこの先順序回路を多く使用します。その際、後々のトラブルを避けるため、以下のような書き方を避けることをおすすめします。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (reset, clock, a, b)
begin
  if (reset = &#39;1&#39;) then
    ～ RESET-PROCEDURE ～
  elsif (clock&#39;event and clock = &#39;1&#39; and a = &#39;1&#39;) then
    ～ PROCEDURE-A ～
  elsif (clock&#39;event and clock = &#39;1&#39; and b = &#39;1&#39;) then
    ～ PROCEDURE-B ～
  end if;
end process;
</pre></div>
</div>
<p>どうやら、リセット処理(RESET-PROCEDURE)、クロックに同期した上で a が 1 の時の処理(PROCEDURE-A)、クロックに同期した上で b が 1 の時の処理(PROCEDURE-B)を行いたいらしい。</p>
<p>このような場合は以下のように、クロックによる動作と論理を分離して記述すると良いでしょう。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (reset , clock)
begin
  if (reset = &#39;1&#39;) then
    ～ RESET PROCEDURE ～
  elsif (clock&#39;event and clock = &#39;1&#39;) then
    if (a = &#39;1&#39;) then
      ～ PROCEDURE A ～
    elsif (b = &#39;1&#39;) then
      ～ PROCEDURE B ～
    end if;
  end if;
end process ;
</pre></div>
</div>
<p>クロックの条件に追加で書いていると、この授業のレベルではその箇所でミスをしやすくなります。</p>
<p>またクロックの条件と分離することで、他へのコピー＆ペーストでのミスも減ります。</p>
<p>このほか、以下の箇所で代入を行っても、意図した動作にならない可能性が高いです。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>process (reset , clock)
begin
  if (reset = &#39;1&#39;) then
    ～ RESET PROCEDURE ～
  elsif (clock&#39;event and clock = &#39;1&#39;) then
    ～ MAIN PROCEDURE ～
  end if;
  a &lt;= b;
end process;
</pre></div>
</div>
<p>a へ b を代入していますが、この位置ではセンシティビティリストに入る reset と clock の条件を無視した位置にあるため、どのような動作になるか保証できません。</p>
<p>process 文の外か、if 文の中に入れましょう。</p>
</div>
<div class="section" id="id13">
<h4><span class="section-number">5.7.6. </span>演習<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl05</p>
<p>D フリップフロップを作る</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span> <span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl05</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">sw1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span> <span class="p">;</span> <span class="c1">-- data</span>
    <span class="n">sw2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span> <span class="p">;</span> <span class="c1">-- clock</span>
    <span class="n">sw3</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span> <span class="p">;</span> <span class="c1">-- reset</span>
    <span class="n">led1</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl05</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl05</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">d</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">dff</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">sw2</span><span class="p">,</span> <span class="n">sw3</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sw3</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">d</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="n">sw2</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">sw2</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">sw1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>ヒント</p>
<p>&quot;--&quot; (マイナス２個) 以降は改行までコメントとして無視されます。</p>
<p>この例では、sw1 をデータ入力、sw2 をクロック、sw3 をリセットとして使用しています。</p>
<p>シグナル d を D フリップフロップの実態という意味で定義しています。</p>
<p>sw3 を H にすると、フリップフロップをリセットします。</p>
<p>sw2 が H に変化したタイミング (立ち上がりエッジ) で、sw1 の内容を d へ代入します。そのほかのタイミングでは sw1 の変化の影響を受けません。</p>
<p>process 文内の処理は sw2 と sw3 の変化でしか行われないため、センシティビティリストには sw2 と sw3 しか書いていません。</p>
<p>led1 には d の内容を出力しています。</p>
<div class="figure align-center">
<img alt="_images/figure13.png" src="_images/figure13.png" />
</div>
<p>動作確認</p>
<ol class="arabic simple">
<li><p>sw1、sw2、sw3 をすべて OFF にする。</p></li>
<li><p>まず sw3 を ON → OFF して、リセットする。</p></li>
<li><p>sw2 を ON → OFF して、led1 が変化しないことを確認する。 (入力データ sw1 が OFF なので、OFF のデータを改めてサンプルするだけ)</p></li>
<li><p>sw1 を ON にする。</p></li>
<li><p>sw2 を ON → OFF して、 led1 が変化することを確認する。</p></li>
<li><p>sw1 を OFF にしても led1 が変化しないことを確認する。</p></li>
<li><p>sw2 を ON → OFF して、 led1 が変化することを確認する。</p></li>
</ol>
</div>
<div class="section" id="id14">
<h4><span class="section-number">5.7.7. </span>課題<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl06</p>
<p>下記のソースコードに追記して、JK フリップフロップを作れ</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl06</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">sw1</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- J</span>
    <span class="n">sw2</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- clock</span>
    <span class="n">sw3</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- K</span>
    <span class="n">sw4</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- reset</span>
    <span class="n">led1</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl06</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl06</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">jk</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">jkff_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">sw4</span><span class="p">,</span> <span class="n">sw2</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sw4</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c1">-- put code below --</span>

       <span class="c1">-- put code above --</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="n">sw2</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">sw2</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c1">-- put code below --</span>

       <span class="c1">-- put code above --</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">jk</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>２箇所の&quot;put code below&quot; から&quot;put code above&quot; の間にコードを書いてください。</p>
<p>ソースコード中で指定しているようなスイッチのアサインで、JK フリップフロップを作成してください。</p>
<div class="figure align-center">
<img alt="_images/figure14.png" src="_images/figure14.png" />
</div>
<table class="docutils align-default" id="id37">
<caption><span class="caption-text">真理値表</span><a class="headerlink" href="#id37" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>sw2 (clock)</p></th>
<th class="head"><p>sw1(J)</p></th>
<th class="head"><p>sw3(K)</p></th>
<th class="head"><p>led1(Q → jk)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>↑以外</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>維持</p></td>
</tr>
<tr class="row-odd"><td><p>↑</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>維持</p></td>
</tr>
<tr class="row-even"><td><p>↑</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>↑</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>↑</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>反転</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>「維持」は、自分自身を代入することで行えます。</p>
</div>
<p>動作確認は以下の通り行います。</p>
<ol class="arabic simple">
<li><p>sw1 ～ sw4 を OFF にする。</p></li>
<li><p>sw4 を ON → OFF として、リセットする (led1 が点灯する) 。</p></li>
<li><p>sw1 を ON → OFF として、led1 が変化しないことを確認する (J だけ動かしている) 。</p></li>
<li><p>sw3 を ON → OFF として、led1 が変化しないことを確認する (K だけ動かしている) 。</p></li>
<li><p>sw1 を ON にし、sw2 を ON → OFF として、led1 が消灯することを確認する。</p></li>
<li><p>sw1 を OFF にし、sw2 を ON → OFF としても、led1 が消灯したままであることを確認する。</p></li>
<li><p>sw3 を ON にし、sw2 を ON → OFF として、led1 が点灯することを確認する。</p></li>
<li><p>sw3 を OFF にし、sw2 を ON → OFF としても、led1 が点灯したままとなることを確認する。</p></li>
<li><p>sw1 、sw3 を ON にし、sw2 を ON → OFF として、led1 が消灯することを確認する (注記参照) 。</p></li>
<li><p>sw1 、sw3 を ON にしたままで、sw2 を ON → OFF として、led1 が点灯することを確認する (注記参照) 。</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>最後の２つは、想定通りに動いたり、動かなかったりする。これは後述するチャタリングが原因。</p>
</div>
</div>
</div>
<div class="section" id="id15">
<h3><span class="section-number">5.8. </span>カウンタ<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フリップフロップはクロックに合わせて値を保持します。複数ビットのフリップフロップの組み合わせの出力に加算器を接続し、その結果をフリップフロップに戻すことで、次のクロックでは加算後の結果が保持されます。</p>
<p>加える値が１であれば、１ずつ増えていくカウンタとなります。</p>
<div class="figure align-center">
<img alt="_images/figure15.png" src="_images/figure15.png" />
</div>
<p>プロジェクト名 vhdl07</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl07</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led2</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led3</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led4</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led5</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led6</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led7</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led8</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl07</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl07</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">24</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">count</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led8</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">24</span><span class="p">);</span>
  <span class="n">led7</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">23</span><span class="p">);</span>
  <span class="n">led6</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">22</span><span class="p">);</span>
  <span class="n">led5</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">21</span><span class="p">);</span>
  <span class="n">led4</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">led3</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">19</span><span class="p">);</span>
  <span class="n">led2</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">18</span><span class="p">);</span>
  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">c</span> <span class="p">(</span><span class="mi">17</span><span class="p">);</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>クロックはあらかじめ、32MHz を選択しておきます (JP3、JP4、JP5 のうち JP5 だけショートさせる) 。</p>
<p>カウンタの信号は c で、process 文 count の中でクロックの立ち上がりエッジの度に１を加えます。</p>
<p>c の幅は 25bit なので、0 ～ 33,554,431 までの値を扱うことができます。入力しているクロックが 32MHz なので、約1秒で一周するよう、LED が点灯します。</p>
<p>LED には、上位 8bit のみ表示しています。</p>
<p>この記述では、ソフトウェアの for や while のようなループが書かれていませんが、センシティビティリストの gclk0 の変化 = クロックの変化毎にプロセス文の記述が呼び出されるため、自動的に繰り返し実行されます。</p>
</div>
<div class="section" id="t">
<h3><span class="section-number">5.9. </span>分周回路と T フリップフロップ<a class="headerlink" href="#t" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id16">
<h4><span class="section-number">5.9.1. </span>分周回路<a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>カウンタを応用した回路構成の一つで、元の周波数の整数分の１の周波数を作り出します。</p>
<p>２分周 ( 1/2 の周波数) 、４分周 ( 1/4 の周波数) 、８分周 ( 1/8 の周波数) の例を図に示します。</p>
<div class="figure align-center">
<img alt="_images/figure16.png" src="_images/figure16.png" />
</div>
<p>２分周を超える場合、作られる信号の形は２つのパターンがあります。</p>
<p>一つは、デューティ比 ( H レベルと L レベルの期間の比) ができるだけ５０：５０になるよう近づけたパターン。</p>
<p>もう一つは、作り出した周期の中で１クロック分だけ H レベルとし、残りは L とするパターン。</p>
<p>通常デバイス内では後者、デバイスの外では前者が使われることが多いです。</p>
<p>４分周の２つめのパターンの例を以下に示します。</p>
<p>プロジェクト名 vhdl08</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span> <span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl08</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led2</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl08</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl08</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">div_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

      <span class="c1">-- make 1/4 frequency</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;11&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">r</span><span class="p">;</span>
  <span class="n">led2</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>この中で c は１０進数で０～３までカウントし、r にはそのうち３のときだけ '1' がセットされます。その反転による LED の点灯がされるため、gclk0 32MHz で４周期のうち１サイクルだけ点灯することになり、結果として単純に点灯している led2 に比べ led1 が暗くなります。</p>
<div class="figure align-center">
<img alt="_images/figure17.png" src="_images/figure17.png" />
</div>
</div>
<div class="section" id="id17">
<h4><span class="section-number">5.9.2. </span>課題<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl09</p>
<dl class="simple">
<dt>約１秒周期で led1 の点灯、消灯を繰り返す回路を作れ</dt><dd><p>(約 0.5 秒点灯、約 0.5 秒消灯を繰り返す)</p>
</dd>
</dl>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl09</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
  <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="n">led1</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl09</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl09</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">24</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">-- counter</span>
  <span class="k">signal</span> <span class="n">r</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- invert t when it is H level</span>
  <span class="k">signal</span> <span class="n">t</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span> <span class="c1">-- T flipflop</span>
<span class="k">begin</span>
  <span class="n">cnt_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c1">-- put code below --</span>

       <span class="c1">-- put code above --</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">t_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c1">-- put code below --</span>

       <span class="c1">-- put code above --</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>分周回路と T フリップフロップ (のような動作) を組み合わせて作成します。基板上、JP5 のジャンパをショートし、gclk0 の周波数を 32MHz に設定します。</p>
<p>2カ所のスペースのうち、一つ目には分周回路、二つ目には T フリップフロップを構成します。</p>
<p>分周回路は、１クロックだけ H レベルを作るような構成にする必要があります。先ほどの分周回路では &quot;11&quot; と比較していたところを、今回は (2^25)-1 、つまり&quot;111111111111111111111111&quot;と比較することになります。このときに r を 1 に、それ以外の値の時は 0 にセットします。</p>
<p>T フリップフロップは単純で、入力信号が 1 であれば反転、0 であればデータを維持します。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>signal 宣言した信号は、その architecture 内でグローバル変数のように働きます。同じ architecture 内にある全ての process 文内から読み出すことができます。</p>
</div>
<p>r は、32MHz を 33,554,431 回カウントする毎に 1 になるため、そのたびに t が反転されます。それを led1 に出力すれば、目的の回路ができあがります。</p>
</div>
</div>
<div class="section" id="id18">
<h3><span class="section-number">5.10. </span>積分回路とチャタリング除去<a class="headerlink" href="#id18" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>機械的なスイッチは、切り替えたときに信号の状態が不安定な期間があります。</p>
<div class="figure align-center">
<img alt="_images/figure18.png" src="_images/figure18.png" />
</div>
<p>この不安定な期間は数 ms 程度続く場合もあります。人間にとっては感知できないほど短い時間ですが、FPGA は動作が十分速いため、この細かい変化を検出し、反応してしまいます。たとえば課題 vhdl06 ではこれにより不安定な動作となっています。</p>
<p>そのため、それを除去する回路を組み込む必要があります。これには積分回路を応用します。</p>
<div class="figure align-center">
<img alt="_images/figure19.png" src="_images/figure19.png" />
</div>
<p>積分回路は基本的にはカウンタです。入力を単純に加算していきます。これを応用し、H が入力されている間は上限まで加算 (上限まで来たら値を維持) 、一度でも L が来たら値をクリアします。</p>
<p>この応用した回路に、スイッチからの信号を入力します。スイッチを切り替えない期間では、カウンタの値は０か最大のいずれかで安定します。</p>
<p>スイッチを切り替えた時、入力は H と L が激しく切り替わります。応用した回路では入力の H が一定期間維持されると H を出力するよう動作しますので、この「一定期間」が数ミリ秒となるようなカウンタの最大値を設定すれば良いことになります。</p>
<div class="figure align-center">
<img alt="_images/figure20.png" src="_images/figure20.png" />
</div>
<p>応用回路はたとえば以下のようなソースになります。clock は積分していくサイクル、sw1 がチャタリングのあるスイッチからの入力、r がチャタリング除去後の出力です。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">process</span> <span class="p">(</span><span class="n">clock</span><span class="p">)</span>
<span class="k">begin</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">clock</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clock</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sw1</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">c</span> <span class="o">&lt;=</span> <span class="s">&quot;000000000000000&quot;</span><span class="p">;</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="n">c</span> <span class="o">/=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">sw1</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
      <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<p>最初の if 文では、カウンタによる積分回路を構成しています。</p>
<p>スイッチを 0 側に倒されたら (sw1 = '0') カウンタの値は即０とします。</p>
<p>スイッチが 1 側に倒されたら (sw1 = '1') 、カウンタがいっぱいでなければ (c /= &quot;111111111111111&quot;、&quot;/=&quot;は&quot;一致していない&quot; の意味) カウントします (c &lt;= c + 1) 。</p>
<p>このカウンタは、スイッチが 1 側に倒されれば、カウンタのビットがすべて１になるまでカウントを続け、0 側に倒されればすぐにすべて０に戻します。</p>
<p>スイッチからの信号が不安定な状態では、少しでも０がくればカウンタも０に戻されますが、十分安定すれば最後までカウントします。</p>
<p>32MHz であれば１周期は約 31ns なので、15bit で 32000 回カウントすれば約１ｍｓになります。スイッチが約１ｍｓ安定すれば、最後までカウントされることになります。</p>
<p>次の if 文では、前のカウンタが最後までカウントされたら１、それ以外は０を出力します。スイッチ入力が安定したことを判定することができます。</p>
<p>このままでは１ｍｓしか対応できないため、チャタリングが除去し切れていないように見える場合はカウンタのビットを追加する必要があります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>std_logic_vector の桁数が、比較演算子の左右で一致していない場合、正しく比較されない場合があります。
思ったように動作しない場合は、桁数も確認してください。</p>
</div>
<div class="section" id="id19">
<h4><span class="section-number">5.10.1. </span>シミュレーション<a class="headerlink" href="#id19" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>チャタリング除去の動作をシミュレーションで確認します。</p>
<p>D:\Altera\(学籍番号) に vhdl21 というフォルダを作ります。</p>
<p>Web ブラウザで <a class="reference external" href="http://vhdl.cottonrose.jp/2016/">http://vhdl.cottonrose.jp/2016/</a> を開き、vhdl21.vhd をダウンロードし、先ほどのフォルダにダウンロードします。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ダウンロードしたファイルが読み取り専用になっていることがあります。</p>
</div>
<p>別冊「Altera開発環境（QuartusII）使用マニュアル」の 21 ページからのシミュレーションの手順を行います。</p>
<p>signal の s_switch が、人間がイメージしているスイッチの ON/OFF です。</p>
<p>sw1 は FPGA からみた入力信号を模擬しています。</p>
<p>r が、チャタリング除去後の信号で、s_switch よりは時間が短いものの、sw1 のような信号のばたつきが無くなっていることが分かります。</p>
<p>シミュレーション完了後、Wave のエリアで signal c に対し右クリック → Radix → Unsigned 、もう一度右クリック → Format → Analog (Automatic) で、チャタリング除去に使用したカウンタの値の変化を違った形で見ることができます。
チャタリングが出ているときは、ここでは 1 までしかカウントできず直ぐに 0 に戻されていることが分かります。</p>
</div>
</div>
<div class="section" id="id20">
<h3><span class="section-number">5.11. </span>微分回路<a class="headerlink" href="#id20" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>人間や機械からの信号= 遅い信号と高速な内部の回路とのインタフェースをしやすくする回路です。</p>
<p>たとえばスイッチを動かす度に LED の点灯、消灯を切り替えたいとします。タイミングチャートは以下のようなものです。</p>
<div class="figure align-center">
<img alt="_images/figure21.png" src="_images/figure21.png" />
</div>
<p>スイッチ入力をクロックとして T フリップフロップに入力できれば実現できますが、同期動作ではないためトラブルの原因になりやすく、採用できません。</p>
<p>出力の信号を生成しているフリップフロップのクロックが十分遅ければやはり T フリップフロップで対応できそうですが、今回のボードに限らず通常は MHz 級の動作周波数ですのでそのような動作はできません。</p>
<div class="figure align-center">
<img alt="_images/figure22.png" src="_images/figure22.png" />
</div>
<p>スイッチ入力の変化点を検出する回路ができれば、T フリップフロップでも望みの動作が可能になります。</p>
<div class="figure align-center">
<img alt="_images/figure23.png" src="_images/figure23.png" />
</div>
<p>変化点を検出するため、微分回路と呼ばれる回路を使用します。</p>
<div class="figure align-center">
<img alt="_images/figure24.png" src="_images/figure24.png" />
</div>
<p>原理は簡単で、フリップフロップ２段を通して１クロックずつ遅延した信号の間の特定の差だけを抽出します。</p>
<p>実際の回路は以下のようになります。</p>
<div class="figure align-center">
<img alt="_images/figure25.png" src="_images/figure25.png" />
</div>
<div class="section" id="id21">
<h4><span class="section-number">5.11.1. </span>演習<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl10</p>
<p>スイッチを往復させる毎に LED の点灯、消灯を切り替える回路を作る。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl10</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw1</span>   <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl10</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl10</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span>  <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">14</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r</span>  <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">d1</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">d2</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s</span>  <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">t</span>  <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="c1">-- chattering cancel</span>
  <span class="n">sum_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sw1</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">c</span> <span class="o">&lt;=</span> <span class="s">&quot;000000000000000&quot;</span><span class="p">;</span>
      <span class="k">elsif</span> <span class="p">((</span><span class="n">c</span> <span class="o">/=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">sw1</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
        <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="c1">-- difference</span>
  <span class="n">diff_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">d2</span> <span class="o">&lt;=</span> <span class="n">d1</span><span class="p">;</span>
      <span class="n">d1</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
  <span class="n">s</span> <span class="o">&lt;=</span> <span class="n">d1</span> <span class="k">and</span> <span class="p">(</span><span class="k">not</span> <span class="n">d2</span><span class="p">);</span>

  <span class="c1">-- T flipflop</span>
  <span class="n">t_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">t</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">t</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>diff proc とその直後の s への代入が微分回路になります。</p>
</div>
</div>
<div class="section" id="id22">
<h3><span class="section-number">5.12. </span>１０進カウンタ<a class="headerlink" href="#id22" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id23">
<h4><span class="section-number">5.12.1. </span>課題<a class="headerlink" href="#id23" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>プロジェクト名 vhdl11</p>
<p>０～９まで、１秒間に１ずつカウントする、１０進カウンタを作れ。カウント値は９の次は０に戻る。
signal r は１秒に１回、１サイクルだけ H レベルになる信号となる。
led1 が点滅する場合は誤りがある。</p>
<p>プロセス文 div_proc が１秒を作る。それを利用してプロセス文 cnt_proc 内で signal c で０～９をカウントする。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span> <span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl11</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1a</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1b</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1c</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1d</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1e</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1f</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1g</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl11</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl11</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">d</span>    <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">24</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r</span>    <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">c</span>    <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">sled</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">6</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">ck</span>   <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">div_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="s">&quot;1111010000100011111111111&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
        <span class="n">d</span> <span class="o">&lt;=</span> <span class="s">&quot;0000000000000000000000000&quot;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
        <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">cnt_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c1">-- put code below --</span>


       <span class="c1">-- put code above --</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">chk_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;1010&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
        <span class="n">ck</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">ck</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">sled</span> <span class="o">&lt;=</span> <span class="s">&quot;0010000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;1001&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;1000&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1111000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0111&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0110&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0010010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0101&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0011001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0100&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0110000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0011&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0100100&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0010&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1111001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0001&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;0000&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000110&quot;</span><span class="p">;</span>
  <span class="n">sled1a</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">sled1b</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">sled1c</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">sled1d</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">sled1e</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">sled1f</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">sled1g</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">6</span><span class="p">);</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="n">ck</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>７セグメント LED の点灯パターンはコードの通りになる、LED の配置は図のようになっています。port に L を出力すると、電位差で電流が流れ LED が点灯します。</p>
</div>
</div>
<div class="section" id="id24">
<h3><span class="section-number">5.13. </span>階層設計<a class="headerlink" href="#id24" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>規模が大きくなってくると、すべてのコードを一つの architecture に書ききることが問題になります。そのためコードを機能ブロック毎に分割し呼び出すことができるようになっています。
例を以下に示します。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity Y_child is
  port (
  ～ PORT_DEFINITION(CHILD) ～
  );
end Y child ;

architecture A_Y_child of Y_child is
  ～ SIGNAL_DEFINITION(CHILD) ～
begin
  ～ EXPRESSIONS(CHILD) ～
end A Y chi ld ;


library ieee ;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity X_parent is
  port (
    ～ PORT_DEFINITION(PARENT) ～
  );
end X_parent;

architecture A_X_parent of X_parent is

  component Y_child
    port (
      ～ PORT_DEFINITION(CHILD) ～
    );
  end component;

  ～ SIGNAL_DEFINITION(PARENT) ～

begin

  i_Y_child : Y_child
    port map (
      ～ PORT_CONNECTION(CHILD PARENT) ～
    );

  ～ OTHER_EXPRESSIONS(PARENT) ～

end A_X_parent;
</pre></div>
</div>
<p>処理を抜き出した、他から呼び出される側の entity は、通常通り作成します。</p>
<p>処理を呼び出す場合は２段階の手続きがあります。</p>
<p>まず architecture から begin までの間で、component 宣言を行います。ここで、呼び出す entity はすべて宣言します。</p>
<p>次に begin の後で、実際に呼び出します。複数個呼び出すこともできますが、その場合は entity 名の前のコロンの前、インスタンス名 (ここでは i_Y_child ) はそれぞれ固有のものにします。</p>
<div class="section" id="id25">
<h4><span class="section-number">5.13.1. </span>演習<a class="headerlink" href="#id25" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>１０進数カウンタに階層化を適用します。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>counter10.vhd と ledconv.vhd は、vhdl11b プロジェクトを作成した後、それぞれ vhdl11b.vhd と同様に file → new → VHDL file で作成します。</p>
</div>
<p>counter10.vhd</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">counter10</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>

    <span class="n">e_in</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">c_in</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>

    <span class="n">c_out</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>

    <span class="n">cnt</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span> <span class="p">;</span>
<span class="k">end</span> <span class="nc">counter10</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">counter10</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">cnt_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">sw2</span><span class="p">,</span> <span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sw2</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">c</span> <span class="o">&lt;=</span> <span class="s">&quot;0000&quot;</span><span class="p">;</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">e_in</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">c_in</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
        <span class="c1">-- put code below --</span>

        <span class="c1">-- put code above --</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">c_out</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;1001&quot;</span><span class="p">)</span>
      <span class="k">else</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>c_in は下の桁からの桁上げのリクエストを受け付けるポート、c_out は上の桁への桁上げのリクエストを出力するポートです。</p>
<p>e_in は H レベルが入るとカウントを行うポートです。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">((</span><span class="n">e_in</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">c_in</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
</pre></div>
</div>
<p>の箇所は、これまでのカウンタのソースでの r = '1' に相当します。</p>
<p>ledconv.vhd</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">ledconv</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">cnt</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">sledxa</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxb</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxc</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxd</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxe</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxf</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sledxg</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">ledconv</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">ledconv</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">sled</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">6</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">sled</span> <span class="o">&lt;=</span> <span class="s">&quot;0010000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;1001&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;1000&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1111000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0111&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0110&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0010010&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0101&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0011001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0100&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0110000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0011&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0100100&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0010&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1111001&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0001&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;1000000&quot;</span> <span class="k">when</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="s">&quot;0000&quot;</span><span class="p">)</span>
     <span class="k">else</span> <span class="s">&quot;0000110&quot;</span><span class="p">;</span>
  <span class="n">sledxa</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">sledxb</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">sledxc</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">sledxd</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">sledxe</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">sledxf</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">sledxg</span> <span class="o">&lt;=</span> <span class="n">sled</span> <span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>sledxa から sledxg は７セグ LED の各端子に相当します。vhdl11b では１桁のみ使うため、sled1a ～ sled1g と対応させています。これが４桁になる場合、ledconv を４個用意し、sled1a ～ sled1g から sled4a ～ sled4g までに対応させます。</p>
<p>プロジェクト名 vhdl11b</p>
<p>vhdl11b.vhd</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl11b</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1a</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1b</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1c</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1d</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1e</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1f</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sled1g</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl11b</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl11b</span> <span class="k">is</span>
  <span class="k">component</span> <span class="nc">counter10</span>
    <span class="k">port</span> <span class="p">(</span>
      <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sw2</span>   <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>

      <span class="n">e_in</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">c_in</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>

      <span class="n">c_out</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>

      <span class="n">cnt</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="k">end</span> <span class="k">component</span><span class="p">;</span>

  <span class="k">component</span> <span class="nc">ledconv</span>
    <span class="k">port</span> <span class="p">(</span>
      <span class="n">cnt</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">sledxa</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxb</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxc</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxd</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxe</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxf</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sledxg</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
    <span class="p">);</span>
  <span class="k">end</span> <span class="k">component</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">d</span>      <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">24</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r</span>      <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">c_in1</span>  <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">c_out1</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">cnt1</span>   <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">div_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="s">&quot;1111010000100011111111111&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">d</span> <span class="o">&lt;=</span> <span class="s">&quot;0000000000000000000000000&quot;</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">c_in1</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>

  <span class="n">i_counter1</span> <span class="o">:</span> <span class="n">counter10</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span> <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw2</span>   <span class="o">=&gt;</span> <span class="n">sw2</span><span class="p">,</span>
      <span class="n">e_in</span>  <span class="o">=&gt;</span> <span class="n">r</span><span class="p">,</span>
      <span class="n">c_in</span>  <span class="o">=&gt;</span> <span class="n">c_in1</span><span class="p">,</span>
      <span class="n">c_out</span> <span class="o">=&gt;</span> <span class="n">c_out1</span><span class="p">,</span>
      <span class="n">cnt</span>   <span class="o">=&gt;</span> <span class="n">cnt1</span>
    <span class="p">);</span>

  <span class="n">i_conv1</span> <span class="o">:</span> <span class="n">ledconv</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">cnt</span>    <span class="o">=&gt;</span> <span class="n">cnt1</span><span class="p">,</span>
      <span class="n">sledxa</span> <span class="o">=&gt;</span> <span class="n">sled1a</span><span class="p">,</span>
      <span class="n">sledxb</span> <span class="o">=&gt;</span> <span class="n">sled1b</span><span class="p">,</span>
      <span class="n">sledxc</span> <span class="o">=&gt;</span> <span class="n">sled1c</span><span class="p">,</span>
      <span class="n">sledxd</span> <span class="o">=&gt;</span> <span class="n">sled1d</span><span class="p">,</span>
      <span class="n">sledxe</span> <span class="o">=&gt;</span> <span class="n">sled1e</span><span class="p">,</span>
      <span class="n">sledxf</span> <span class="o">=&gt;</span> <span class="n">sled1f</span><span class="p">,</span>
      <span class="n">sledxg</span> <span class="o">=&gt;</span> <span class="n">sled1g</span>
    <span class="p">);</span>

<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>この状態で、ソースコードの関係は以下のようになります。</p>
<p>counter10 を呼び出しているときのキーワード &quot;i_counter1&quot; や ledconv に対する &quot;i_conv1&quot; がインスタンス名となります。固有のインスタンス名をつけることで、同じ回路ブロックを複数回呼び出すことができます。</p>
<p>ポートの接続はこのコードのように、左辺に呼び出される回路のポート名、=&gt; をはさんで右辺に呼び出し側の port 名または signal 名を書き、カンマで区切ります。カンマは区切りなので最後の接続の後には書きません。</p>
</div>
<div class="section" id="id26">
<h4><span class="section-number">5.13.2. </span>シミュレーション &amp; 演習<a class="headerlink" href="#id26" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="admonition-todo admonition" id="id27">
<p class="admonition-title">課題</p>
<p>タイミングチャートの読み方がわからない</p>
</div>
<p>先ほどの階層設計を応用して、10 進数 3 桁のカウンタを作り、シミュレータ上で動作を確認します。</p>
<p>D:\Altera\(学籍番号) に vhdl22 というフォルダを作ります。</p>
<p>Web ブラウザで <a class="reference external" href="http://vhdl.cottonrose.jp/2016/">http://vhdl.cottonrose.jp/2016/</a> を開き、vhdl22.vhd をダウンロードし、先ほどのフォルダにダウンロードします。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ダウンロードしたファイルが読み取り専用になっていることがあります。</p>
</div>
<p>vhdl11b で使った counter10.vhd も、このフォルダにコピーしておきます。</p>
<p>別冊「Altera開発環境（QuartusII）使用マニュアル」の 21 ページからのシミュレーションの手順を行います。</p>
<p>途中のコンパイルでは <strong>先に counter10.vhd をコンパイル</strong> しておきます。</p>
<p>このソースコードは、そのままでは 10 進数のカウンタが 3 個並び、同じようにカウントするだけになっています。</p>
<p>これを <strong>改造</strong> し、10 進数 3 桁のカウンタにしてください。</p>
<p>ソースコードの抜粋を以下に示します。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="c1">-- COUNTERS ------------------------------------------------------------------</span>

<span class="n">i_counter_0</span><span class="o">:</span> <span class="n">counter10</span>
  <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span> <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw2</span>   <span class="o">=&gt;</span> <span class="n">sw2</span><span class="p">,</span>
      <span class="n">e_in</span>  <span class="o">=&gt;</span> <span class="n">s_e_in_to_0</span><span class="p">,</span>
      <span class="n">c_in</span>  <span class="o">=&gt;</span> <span class="n">s_c_in_to_0</span><span class="p">,</span>
      <span class="n">c_out</span> <span class="o">=&gt;</span> <span class="n">s_c_out_from_0</span><span class="p">,</span>
      <span class="n">cnt</span>   <span class="o">=&gt;</span> <span class="n">s_cnt_0</span>
  <span class="p">);</span>

<span class="n">i_counter_1</span><span class="o">:</span> <span class="n">counter10</span>
  <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span> <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw2</span>   <span class="o">=&gt;</span> <span class="n">sw2</span><span class="p">,</span>
      <span class="n">e_in</span>  <span class="o">=&gt;</span> <span class="n">s_e_in_to_1</span><span class="p">,</span>
      <span class="n">c_in</span>  <span class="o">=&gt;</span> <span class="n">s_c_in_to_1</span><span class="p">,</span>
      <span class="n">c_out</span> <span class="o">=&gt;</span> <span class="n">s_c_out_from_1</span><span class="p">,</span>
      <span class="n">cnt</span>   <span class="o">=&gt;</span> <span class="n">s_cnt_1</span>
  <span class="p">);</span>

<span class="n">i_counter_2</span><span class="o">:</span> <span class="n">counter10</span>
  <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span> <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw2</span>   <span class="o">=&gt;</span> <span class="n">sw2</span><span class="p">,</span>
      <span class="n">e_in</span>  <span class="o">=&gt;</span> <span class="n">s_e_in_to_2</span><span class="p">,</span>
      <span class="n">c_in</span>  <span class="o">=&gt;</span> <span class="n">s_c_in_to_2</span><span class="p">,</span>
      <span class="n">c_out</span> <span class="o">=&gt;</span> <span class="n">s_c_out_from_2</span><span class="p">,</span>
      <span class="n">cnt</span>   <span class="o">=&gt;</span> <span class="n">s_cnt_2</span>
  <span class="p">);</span>

<span class="c1">-- edit connection here ------------------------------------------------------</span>

<span class="n">s_e_in_to_0</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span>
<span class="n">s_c_in_to_0</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="c1">-- s_c_out_from_0</span>

<span class="n">s_e_in_to_1</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span>
<span class="n">s_c_in_to_1</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="c1">-- s_c_out_from_1</span>

<span class="n">s_e_in_to_2</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span>
<span class="n">s_c_in_to_2</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="c1">-- s_c_out_from_2</span>

<span class="c1">------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>ソースコード中の edit connection here にある 9 つの signal の接続を編集することで実現できます。</p>
<p>counter10 の e_in と c_in は、両方に 1 が入力されるとカウントするように働きます。
c_out は、カウント値が 9 の時に 1 になります。</p>
<p>counter10 のポートの役割は以下の通りです。</p>
<dl class="simple">
<dt>gclk0</dt><dd><p>クロック入力</p>
</dd>
<dt>sw2</dt><dd><p>リセット入力</p>
</dd>
<dt>e_in</dt><dd><p>カウントしたいタイミングの入力</p>
</dd>
<dt>c_in</dt><dd><p>下の桁からの桁上げ信号の入力</p>
</dd>
<dt>c_out</dt><dd><p>上の桁への桁上げ信号の出力</p>
</dd>
</dl>
<p>3 桁分の counter10 から合計 9 つの signal が引き出されています。</p>
<p>一度シミュレータでこれらの信号の動きを確認し、要求通りの動作をするように、signal の接続を変更してください。</p>
<p>シミュレーション用のコードは判定機能を持っています。</p>
<p>Transcript エリアに &quot;Simulation finished with 0 errors.&quot; と表示されると、正しく動作したと判定されます。</p>
<p>もし数字が 0 でなかったり、&quot;Simulation timed out with <strong>* errors.&quot; (*</strong> は数字 ) と表示されたら、何かしらのエラーがあることになります。</p>
</div>
</div>
<div class="section" id="case-when">
<h3><span class="section-number">5.14. </span>状態遷移と、条件分岐 case ～ when ～<a class="headerlink" href="#case-when" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>例えばカップラーメンを食べようとした場合でも、 (誰かが作ってくれる場合を除いて) 手順があります。</p>
<ol class="arabic simple">
<li><p>カップラーメンの包装をといてふたを開けて小袋をとりだす。必要なものはここで入れる。</p></li>
<li><p>やかんに水を入れてコンロにかけて沸かす。</p></li>
<li><p>沸騰するのを待つ。</p></li>
<li><p>沸騰したら火を止めて、お湯をカップに注ぐ。</p></li>
<li><p>３分 (または５分) 待つ。</p></li>
<li><p>必要に応じて小袋の中身をカップに入れる。まぜる。</p></li>
<li><p>食べてよし。</p></li>
</ol>
<p>小袋が入ってなかったり電気ポットでお湯を沸かしたり、湯切りタイプだったりとバリエーションがありますが、オーソドックなものではこのように順番があり、例えば１、２は入れ替えたり並列に行ってもいいですが、基本的に手順通りに行います。</p>
<p>プログラミングもこういったところに似ていますが、このように手順通りに処理を行いたい場合、ソフトウェアと同様状態遷移の考え方を使います。</p>
<p>状態遷移は通常は図で状態間のつながりを描きながら設計をし、ソースコードには人間が考えながら書き込むしかありません (図を描くことでソースコードを出力してくれるツールもあります) 。</p>
<p>ソースコード上で、各「状態」を数字で表しながらコーディングすることもできますが、各「状態」に名前をつけて管理しやすくすることができます。</p>
<blockquote>
<div><p>( C 言語の enum と同じような働きです)</p>
</div></blockquote>
<p>使い方はたとえば以下のようになります。</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">RAMEN</span> <span class="k">is</span> <span class="p">(</span><span class="n">MAKE_READY_CUP</span><span class="p">,</span> <span class="n">BOILWATER</span><span class="p">,</span> <span class="n">POURWATER</span><span class="p">,</span> <span class="n">WAIT_MINUTES</span><span class="p">,</span> <span class="n">READY_TO_EAT</span><span class="p">);</span>
<span class="k">signal</span> <span class="n">ramen_stat</span> <span class="o">:</span> <span class="n">RAMEN</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">ramen_stat</span> <span class="o">&lt;=</span> <span class="n">MAKEREADY</span><span class="p">;</span>
</pre></div>
</div>
<p>１行目では RAMEN という型を新しく定義しています。この型のとりうる値は&quot;MAKE_READY_CUP&quot;以降の５種類です。</p>
<p>２行目では、RAMEN の型の signal 、ramen_stat を宣言します。</p>
<p>ramen_stat には MAKE_READY_CUP など、定義した名前を代入したり、if 文で比較したりすることができます。ただし勝手に作った型ですので、そのままでは port から出力しても使えませんし、例えば LED の点灯パターンに対しては全く対応がとれないため使えません。あくまで内部で使うのが基本です。</p>
<p>このようにしなくても、自分でこれらの状態を管理すれば、たとえば integer の signal ででも管理できます。ただしわかりやすい名前をつけることで、ソースコードが理解しやすくなります。</p>
</div>
<div class="section" id="id28">
<h3><span class="section-number">5.15. </span>条件分岐 case ～ when ～<a class="headerlink" href="#id28" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>case 文は process 文の中でのみ使用できます。</p>
<p>状態遷移専用ではありませんが、case 文はよく組み合わされて使われます。基本的な形は以下の通りです。</p>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span>case (CONDITION_SIGNAL) is
  when (VALUE_A) =&gt; ～ EXPRESSION A ～
  when (VALUE_B) =&gt; ～ EXPRESSION B ～
  when others =&gt; ～ EXPRESSION OTHER ～
end case;
</pre></div>
</div>
<p>ある一つの signal の値毎に処理を分岐させることができます。処理は、次の when まで何行でも書くことができます。</p>
<div class="section" id="id29">
<h4><span class="section-number">5.15.1. </span>演習<a class="headerlink" href="#id29" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>スイッチによって、特定の LED を点灯させる回路を作る。
* LED1 が点灯している場合、sw2 を操作することで LED1 が消灯し、LED2 が点灯する。
* LED2 が点灯している場合、sw1 を操作することで LED2 が消灯し、LED1 が点灯する。sw2 を操作した場合は、LED2 が消灯し、LED3 が点灯する。
* LED3 が点灯している場合、sw1 を操作することで LED3 が消灯し、LED2 が点灯する。</p>
<p>swfilter.vhd</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span> <span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">swfilter</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw_out</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">swfilter</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">swfilter</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">c</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">14</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">d1</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">d2</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">s</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">sum_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sw</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">c</span> <span class="o">&lt;=</span> <span class="s">&quot;000000000000000&quot;</span><span class="p">;</span>
      <span class="k">elsif</span> <span class="p">((</span><span class="n">c</span> <span class="o">/=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="n">sw</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">))</span> <span class="k">then</span>
        <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;111111111111111&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">r</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">diff_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">d1</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span>
      <span class="n">d2</span> <span class="o">&lt;=</span> <span class="n">d1</span><span class="p">;</span>
      <span class="n">s</span> <span class="o">&lt;=</span> <span class="n">d1</span> <span class="k">and</span> <span class="p">(</span><span class="k">not</span> <span class="n">d2</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">sw_out</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>プロジェクト名 vhdl12</p>
<p>vhdl12.vhd</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_arith.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_unsigned.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">vhdl12</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">gclk0</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw1</span>   <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">sw2</span>   <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led1</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led2</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">led3</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="nc">vhdl12</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">vhdl12</span> <span class="k">is</span>
  <span class="k">component</span> <span class="nc">swfilter</span>
    <span class="k">port</span> <span class="p">(</span>
      <span class="n">gclk0</span>  <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sw</span>     <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">sw_out</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
    <span class="p">);</span>
  <span class="k">end</span> <span class="k">component</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">sw1d</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">sw2d</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>

  <span class="k">type</span> <span class="n">LED_STAT</span> <span class="k">is</span> <span class="p">(</span><span class="n">P_LED1</span><span class="p">,</span> <span class="n">P_LED2</span><span class="p">,</span> <span class="n">P_LED3</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">lstat</span> <span class="o">:</span> <span class="n">LED_STAT</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">led</span> <span class="o">:</span> <span class="kt">std_logic_vector</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">sw1_filter</span> <span class="o">:</span> <span class="n">swfilter</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span>  <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw</span>     <span class="o">=&gt;</span> <span class="n">sw1</span><span class="p">,</span>
      <span class="n">sw_out</span> <span class="o">=&gt;</span> <span class="n">sw1d</span>
    <span class="p">);</span>

  <span class="n">sw2_filter</span> <span class="o">:</span> <span class="n">swfilter</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">gclk0</span>  <span class="o">=&gt;</span> <span class="n">gclk0</span><span class="p">,</span>
      <span class="n">sw</span>     <span class="o">=&gt;</span> <span class="n">sw2</span><span class="p">,</span>
      <span class="n">sw_out</span> <span class="o">=&gt;</span> <span class="n">sw2d</span>
    <span class="p">);</span>

  <span class="n">stat_proc</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">gclk0</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gclk0</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">gclk0</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">case</span> <span class="n">lstat</span> <span class="k">is</span>
        <span class="k">when</span> <span class="n">P_LED1</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">sw2d</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">lstat</span> <span class="o">&lt;=</span> <span class="n">P_LED2</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="n">led</span> <span class="o">&lt;=</span> <span class="s">&quot;001&quot;</span><span class="p">;</span>

        <span class="k">when</span> <span class="n">P_LED2</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">sw1d</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">lstat</span> <span class="o">&lt;=</span> <span class="n">P_LED1</span><span class="p">;</span>
          <span class="k">elsif</span> <span class="p">(</span><span class="n">sw2d</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">lstat</span> <span class="o">&lt;=</span> <span class="n">P_LED3</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="n">led</span> <span class="o">&lt;=</span> <span class="s">&quot;010&quot;</span><span class="p">;</span>

        <span class="k">when</span> <span class="n">P_LED3</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">sw1d</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">lstat</span> <span class="o">&lt;=</span> <span class="n">P_LED2</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="n">led</span> <span class="o">&lt;=</span> <span class="s">&quot;100&quot;</span><span class="p">;</span>

        <span class="k">when</span> <span class="k">others</span> <span class="o">=&gt;</span>
          <span class="n">lstat</span> <span class="o">&lt;=</span> <span class="n">P_LED1</span><span class="p">;</span>
          <span class="n">led</span> <span class="o">&lt;=</span> <span class="s">&quot;111&quot;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">case</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">led1</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">led</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">led2</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">led</span> <span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">led3</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">led</span> <span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</pre></div>
</div>
<p>case 文とは関係ありませんが、swfilter は sw にスイッチからの信号を接続し、sw out にチャタリング除去後の信号を出力する回路ブロックです。</p>
</div>
</div>
<div class="section" id="id30">
<h3><span class="section-number">5.16. </span>ストップウォッチ<a class="headerlink" href="#id30" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>1/100 秒単位のストップウォッチを実装する。</p>
<p>表示は４桁の７セグ LED で行い、１０進数のカウントで、99.99 秒までカウントできること。</p>
<div class="section" id="id31">
<h4><span class="section-number">5.16.1. </span>課題：最小限の構成<a class="headerlink" href="#id31" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>ラップ・スプリット機能の無いストップウォッチを実装する。</p>
<p>操作は２つのスイッチで行う。</p>
<dl>
<dt>スタート・ストップスイッチ</dt><dd><p>往復させる毎にカウント動作とストップを切り替える。</p>
<p>カウント動作中にスタート・ストップスイッチを往復させてストップした後、再度スイッチを往復させると、続きからカウント動作を行う。</p>
</dd>
<dt>リセットスイッチ</dt><dd><p>往復させるとカウントしていた値をクリアする。</p>
<p>カウント動作中にリセットスイッチを往復させた場合の動作は定義しない (どのように動作してもよい) 。</p>
</dd>
</dl>
<p>99.99 秒の次のカウントは未定義 (どのように動作してもよい) 。</p>
<div class="section" id="id32">
<h5><span class="section-number">5.16.1.1. </span>ヒント<a class="headerlink" href="#id32" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>vhdl11b に 10 進カウンタ counter10 、7 セグ LED への変換を行う ledconv がひとつずつあって 1 桁の 10 進カウンタができている。vhdl22 の要領で、これを 2 組、3 組、4 組と増やしていき、4 桁の 10 進カウンタを作るのがよい。いきなり 4 桁に挑戦しても躓くことが多い。</p>
<p>1 秒毎にカウントしているので、これを 1/100 毎にカウントするとよい。</p>
<p>スイッチの入力には、vhdl12 のチャタリング除去回路 swfilter が応用できる。</p>
<p>スタート・ストップの切り替えは vhdl10 が応用できる。</p>
<p>今カウント中なのか止まっているのか、判定する signal を作って制御する。ついでにそれを LED に表示するとわかりやすい。</p>
<p>お試しで signal を作るのにためらいは要らない。それを LED に表示しても誰もとがめない。</p>
<p>時々、作った VHDL ファイルを別名でとっておくと良い。内容が把握できなくなったときは、良くない方向に進んでいる可能性が高いので、前の状態からやり直してみる勇気も必要。</p>
</div>
</div>
<div class="section" id="id33">
<h4><span class="section-number">5.16.2. </span>課題：応用<a class="headerlink" href="#id33" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>ラップ、またはスプリット、または両方の機能のついたストップウォッチを実装する。</p>
<p>操作は２つのスイッチで行う。</p>
<dl>
<dt>スタート・ストップスイッチ</dt><dd><p>往復させる毎にカウント動作とストップを切り替える。</p>
<p>カウント動作中にスタート・ストップスイッチを往復させてストップした後、再度スイッチを往復させた場合、続きからカウント動作を行う。</p>
</dd>
<dt>ラップ/スプリット・リセットスイッチ</dt><dd><p>往復させたときの動作状況に合わせて、このスイッチの動作も変化する。</p>
<p>カウントがストップしている時に往復させるとリセット動作として、カウントしていた値をクリアする。</p>
<p>カウント動作中に往復させるとスプリット状態に移る。表示している値は止めるが、カウント動作は継続する。</p>
<p>スプリット状態で再度往復させると、スプリット状態が解除され、カウントしている値の表示を再開する。</p>
<p>スプリット状態でスタート・ストップスイッチを往復させると、表示している値は維持したまま、カウント動作を止める。</p>
<p>スプリット状態 → カウント停止からこのこのスイッチを往復させると、カウントがストップした値を表示する（スプリット状態が解除される）。</p>
<p>この状態でもう一度このスイッチを往復させると、カウントはクリアする (リセット) その前にスタートのスイッチを往復させると、その値からカウントを再開する。</p>
<p>ラップの場合、ボタンを往復させると表示している値をとめ、カウントは０から再開する。</p>
<p>ラップ機能、スプリット機能を両方実装する場合は、スイッチの一つをモードの切り替えに割り振る。</p>
</dd>
</dl>
<p>99.99 秒の次のカウントは00.00 秒とする。</p>
<div class="section" id="id34">
<h5><span class="section-number">5.16.2.1. </span>ヒント<a class="headerlink" href="#id34" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>現在どの状況にいるのかを保持する signal を作り、状態遷移を応用すると良い。</p>
<p>また状況を LED に表示すると良い。</p>
</div>
</div>
<div class="section" id="id35">
<h4><span class="section-number">5.16.3. </span>その他課題<a class="headerlink" href="#id35" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>タイマを作成する。</p>
<p>表示は、上位２桁が「分」、下位２桁が「秒」とする。</p>
<p>第一段階は、決められた時間 (たとえば３分など) のカウントダウンを行う。０までカウントダウンが完了したらそこで停止する。</p>
<p>リセットするとカウントする時間をリロードする。</p>
<p>第二段階は、カウントする時間を２つから選べるようにする (たとえば３分と５分) 。</p>
<p>最後は、任意の時間を設定できるようにする。</p>
</div>
</div>
</div>
<span id="document-06_appendix"></span><div class="section" id="id1">
<h2><span class="section-number">6. </span>付録<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id2">
<h3><span class="section-number">6.1. </span>参考情報<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>VHDL Language Reference Manual</p>
<blockquote>
<div><p>言語の規格</p>
<p><a class="reference external" href="http://ieeexplore.ieee.org/xpl/freeabs">http://ieeexplore.ieee.org/xpl/freeabs</a> all.jsp?reload=true&amp;arnumber=4772740</p>
</div></blockquote>
<p>VHDL によるハードウェア設計入門</p>
<blockquote>
<div><p>CQ 出版/ 長谷川裕恭著</p>
</div></blockquote>
<p>HDL サンプル記述集</p>
<blockquote>
<div><p>CQ 出版</p>
</div></blockquote>
<p>トランジスタ技術 SPECIAL No. 79 初歩のHDL 設計学習帳</p>
<blockquote>
<div><p>CQ 出版</p>
</div></blockquote>
<p>トランジスタ技術 SPECIAL for フレッシャーズ No. 105 ロジック回路設計はじめの一歩</p>
<blockquote>
<div><p>CQ 出版</p>
</div></blockquote>
<p>例題で学ぶ論理回路設計</p>
<blockquote>
<div><p>森北出版/ 富川武彦著</p>
</div></blockquote>
<p>ディジタルコンピューティングシステム</p>
<blockquote>
<div><p>昭晃堂/ 亀山充隆著</p>
</div></blockquote>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html#document-index">Text of reconfigurable device</a></h1>








<h3>ナビゲーション</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-01_introduction">1. はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-02_stopwatch">2. ストップウォッチについて</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-03_fpga">3. FPGA について</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-04_vhdl">4. VHDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-05_try">5. 演習</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-06_appendix">6. 付録</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html#document-index">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Masayuki Takagiwa.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>